<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.1/css/bulma.min.css">

    <title>Calculator</title>
</head>

<!-- Home Page Body -->
<body>
    <!-- Top Navbar-->
    <nav class="navbar" role="navigation">
        <div id="top_navbar" class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item" href="../readme.html">
                    <strong>‚Üê Back to Projects</strong>
                </a>
            </div>
        </div>
    </nav>

    <section class="container">
        <div class="block">
            <h1 class="title is-1">World Clock</h1>
            <hr>
            
            <div class="content">
                <table>
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th></th>
                            <th>Month</th>
                            <th></th>
                            <th>Day</th>
                            <th></th>
                            <th>Hour</th>
                            <th></th>
                            <th>Minute</th>
                            <th></th>
                            <th>Second</th>
                            <th></th>
                            <th>Location</th>
                        </tr>
                    </thead>
                    <tbody>
                        <div id="UTC-time">

                        </div>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</body>

<script>
    var time = new Date(); 
    function count() {
        time = new Date()
        var year = time.getUTCFullYear(); 
        var month = time.getUTCMonth(); 
        var day = time.getUTCDay(); 
        var hour = time.getUTCHours(); 
        var min = time.getUTCMinutes(); 
        var sec = time.getUTCSeconds(); 
        
        var timezone = "UTC"
        update_local_times(timezone, year, month, day, hour, min, sec); 
    }

    function update_local_times(timezone, year, month, day, hour, min, sec){
        var values = [year, month, day, hour, min, sec]; 
        if (timezone == "UTC") {
            document_updater(timezone, values); 
        } 
        else {
            var offset = offset_lookup(timezone); 
            var new_values = offset_calculator(offset, values);
            document_updater(timezone, new_values);  
        }
    }

    function document_updater(timezone, values){
        var local_year = ('000' + values[0]).slice(-4); 
        var local_month = ('0' + values[1]).slice(-2); 
        var local_day = ('0' + values[2]).slice(-2); 
        var local_hour = ('0' + values[3]).slice(-2); 
        var local_min = ('0' + values[4]).slice(-2); 
        var local_sec = ('0' + values[5]).slice(-2); 
        var local_id = timezone; 

        var table_output = [
            local_year, "-", 
            local_month, "-", 
            local_day, "T", 
            local_hour, ":", 
            local_min, ":", 
            local_sec, "@", 
            timezone]
        
        var table_html = "<tr>"
        for (var i = 0; i < 13; i++) {
            table_html = table_html + "<td>" + table_output[i] + "</td>"; 
        }
        table_html = table_html + "</tr>"; 
        document.get("UTC-time").innerHTML = table_html; 
    }

    function offset_calculator(offset, values){
        var utc_year = values[0]; 
        var utc_month = values[1]; 
        var utc_day = values[2]; 
        var utc_hour = values[3]; 
        
        if (offset > 12 || offset < -12) {
            alert("The offset should not exceed 12 in absolute values. ");
        }
        else if (offset > 0) {
        // We need to add hours
            var local_hour = utc_hour + offset; 
            if (local_hour > 23) {
                // We need to add another day
                var extra_hours = local_hour - 24; 
                local_hour = extra_hours; 
                var local_day = utc_day + 1; 
                if (utc_month == 12 && local_day > 31) {
                    var local_year = utc_year + 1; 
                    var local_month = 1; 
                    local_day = local_day - 31; 
                    values[0] = local_year; 
                }
                else if (utc_month == 2 && get_leapyear(utc_year) && local_day > 29){
                    // It's Feb and Leap year
                    // Feb 29 -> Mar 1
                    var local_month = 3; 
                    local_day = local_day - 29; 
                }
                else if (utc_month == 2 && !(get_leapyear(utc_year)) && local_day > 28) {
                    // Feb but not leap
                    var local_month = 3; 
                    local_day = local_day - 28; 
                }
                else if (local_day > 31 && (
                    utc_month == 1 ||
                    utc_month == 3 ||
                    utc_month == 5 ||
                    utc_month == 7 ||
                    utc_month == 8 ||
                    utc_month == 10
                )){
                    var local_month = utc_month + 1; 
                    local_day = local_day - 31; 
                }
                else if (local_day > 30 && (
                    utc_month == 4 ||
                    utc_month == 6 ||
                    utc_month == 9 ||
                    utc_month == 11
                )){
                    var local_month = utc_month + 1; 
                    local_day = local_day - 30;
                }
                else {
                    var local_month = utc_month; 
                }
                
                values[1] = local_month; 
                values[2] = local_day; 
                values[3] = local_hour; 
            }
            else {
                // We don't need to add days 
                values[3] = local_hour; 
            }
        }
        else if (offset < 0) {
            // We need to take away hours 
            var local_hour = utc_hour + offset; 
            if (local_hour < 0) {
                // We need to roll back 1 day
                var extra_hours = local_hour + 24; 
                local_hour = extra_hours; 
                var local_day = utc_day - 1; 
                if (utc_month == 1 && local_day <= 0) {
                    var local_year = utc_year - 1; 
                    var local_month = 12; 
                    local_day = local_day + 31; 
                    values[0] = local_year; 
                }
                else if (utc_month == 3 && get_leapyear(utc_year) && local_day <= 0){
                    // It's March and Leap year
                    // Feb 29 <- Mar 1
                    var local_month = 2; 
                    local_day = local_day + 29; 
                }
                else if (utc_month == 3 && !(get_leapyear(utc_year)) && local_day <= 0) {
                    // Feb 28 <- Mar 1
                    var local_month = 2; 
                    local_day = local_day + 28; 
                }
                else if (local_day <= 0 && (
                    utc_month == 5 ||
                    utc_month == 7 ||
                    utc_month == 10
                )){
                    var local_month = utc_month - 1; 
                    local_day = local_day + 30; 
                }
                else if (local_day <= 0 && (
                    utc_month == 2 ||
                    utc_month == 4 ||
                    utc_month == 6 ||
                    utc_month == 8 || 
                    utc_month == 9 ||
                    utc_month == 11
                )){
                    var local_month = utc_month - 1; 
                    local_day = local_day + 31;
                }
                else {
                    var local_month = utc_month; 
                }
                
                values[1] = local_month; 
                values[2] = local_day; 
                values[3] = local_hour; 
            }
            else {
                // We don't need to roll back days 
                values[3] = local_hour; 
            }

        }
        return values; 
    }

    function get_leapyear(year){
        if (year % 100 == 0) {
            if (year % 400 == 0) {
                return true; 
            }
            else {
                return false; 
            }
        }
        else if (year % 4 == 0) {
            return true; 
        }
    }

    setInterval(count, 1000); 
</script>

</html>